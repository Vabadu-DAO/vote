var De=Object.defineProperty;var Ie=(t,e,n)=>e in t?De(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var U=(t,e,n)=>(Ie(t,typeof e!="symbol"?e+"":e,n),n);import{aX as Kt,aY as Yt,bj as Pt,bk as qt,s as l,T as w,a$ as nt,b2 as I,I as f,b3 as Gt,b4 as Zt,bl as Oe,bm as Fe,b as o,b6 as Qt,b7 as Jt,aZ as Xt,j as u,bn as $e,bo as He,bp as Me,bq as Be,ad as We,u as S,c as A,d as wt,P as M,L as Y,a7 as q,br as Nt,ag as ot,C as v,bs as je,bt as ze,bu as G,f as k,a6 as K,bv as _e,B as tt,i as Ue,aa as Ke,bw as Ye,bx as qe,by as Ge,_ as L,m as st,ak as Dt,bz as Ze,bA as Qe,bB as et,ah as te,a9 as B,ax as Je,bC as Xe,bD as tn,bE as en,a3 as Ct,aA as nn,a4 as on,a5 as ee,bF as sn,ba as rn,U as xt,bG as an,bH as cn,bI as ln,o as it,aC as ne,bJ as dn,bK as un,bL as pn,bM as hn,az as fn,bN as mn,t as rt,bO as P,Z as gn,bP as yn,ar as At,bQ as ft,bR as Tt,bS as bn,bT as vn,F as Sn,p as at,bb as wn,g as Cn,bU as xn,bc as An,aL as Tn,aQ as oe,a2 as En,J as kn,a as Et,h as se,D as Rn,bV as Vn,bW as Ln,E as Pn,l as Nn,bi as Dn,aJ as In,bX as On}from"./index-978b2a1b.js";import{c as Fn,a as mt,C as $n}from"./index.esm-d79d4c21.js";import{L as Hn}from"./List-bf136ca2.js";import{S as Mn}from"./Status-2e7acb8b.js";import{P as Bn}from"./Page-ab8c489a.js";function Wn(t){return Yt("MuiLink",t)}const jn=Kt("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),zn=jn,ie={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},_n=t=>ie[t]||t,Un=({theme:t,ownerState:e})=>{const n=_n(e.color),s=Pt(t,`palette.${n}`,!1)||e.color,i=Pt(t,`palette.${n}Channel`);return"vars"in t&&i?`rgba(${i} / 0.4)`:qt(s,.4)},Kn=Un,Yn=["className","color","component","onBlur","onFocus","TypographyClasses","underline","variant","sx"],qn=t=>{const{classes:e,component:n,focusVisible:s,underline:i}=t,r={root:["root",`underline${nt(i)}`,n==="button"&&"button",s&&"focusVisible"]};return Jt(r,Wn,e)},Gn=l(w,{name:"MuiLink",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`underline${nt(n.underline)}`],n.component==="button"&&e.button]}})(({theme:t,ownerState:e})=>I({},e.underline==="none"&&{textDecoration:"none"},e.underline==="hover"&&{textDecoration:"none","&:hover":{textDecoration:"underline"}},e.underline==="always"&&I({textDecoration:"underline"},e.color!=="inherit"&&{textDecorationColor:Kn({theme:t,ownerState:e})},{"&:hover":{textDecorationColor:"inherit"}}),e.component==="button"&&{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${zn.focusVisible}`]:{outline:"auto"}})),Zn=f.forwardRef(function(e,n){const s=Gt({props:e,name:"MuiLink"}),{className:i,color:r="primary",component:c="a",onBlur:a,onFocus:p,TypographyClasses:m,underline:d="always",variant:h="inherit",sx:g}=s,y=Zt(s,Yn),{isFocusVisibleRef:T,onBlur:b,onFocus:x,ref:E}=Oe(),[D,R]=f.useState(!1),F=Fe(n,E),Z=O=>{b(O),T.current===!1&&R(!1),a&&a(O)},z=O=>{x(O),T.current===!0&&R(!0),p&&p(O)},W=I({},s,{color:r,component:c,focusVisible:D,underline:d,variant:h}),$=qn(W);return o(Gn,I({color:r,className:Qt($.root,i),classes:m,component:c,onBlur:Z,onFocus:z,ref:F,ownerState:W,variant:h,sx:[...Object.keys(ie).includes(r)?[]:[{color:r}],...Array.isArray(g)?g:[g]]},y))}),Qn=Zn,Jn=Xt(o("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),Xn=Xt(o("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),to=l("span")({position:"relative",display:"flex"}),eo=l(Jn)({transform:"scale(1)"}),no=l(Xn)(({theme:t,ownerState:e})=>I({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest})},e.checked&&{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}));function re(t){const{checked:e=!1,classes:n={},fontSize:s}=t,i=I({},t,{checked:e});return u(to,{className:n.root,ownerState:i,children:[o(eo,{fontSize:s,className:n.background,ownerState:i}),o(no,{fontSize:s,className:n.dot,ownerState:i})]})}const oo=f.createContext(void 0),so=oo;function io(){return f.useContext(so)}function ro(t){return Yt("MuiRadio",t)}const ao=Kt("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary"]),It=ao,co=["checked","checkedIcon","color","icon","name","onChange","size","className"],lo=t=>{const{classes:e,color:n}=t,s={root:["root",`color${nt(n)}`]};return I({},e,Jt(s,ro,e))},uo=l($e,{shouldForwardProp:t=>He(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,e[`color${nt(n.color)}`]]}})(({theme:t,ownerState:e})=>I({color:(t.vars||t).palette.text.secondary},!e.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${e.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:qt(e.color==="default"?t.palette.action.active:t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},e.color!=="default"&&{[`&.${It.checked}`]:{color:(t.vars||t).palette[e.color].main}},{[`&.${It.disabled}`]:{color:(t.vars||t).palette.action.disabled}}));function po(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}const Ot=o(re,{checked:!0}),Ft=o(re,{}),ho=f.forwardRef(function(e,n){var s,i;const r=Gt({props:e,name:"MuiRadio"}),{checked:c,checkedIcon:a=Ot,color:p="primary",icon:m=Ft,name:d,onChange:h,size:g="medium",className:y}=r,T=Zt(r,co),b=I({},r,{color:p,size:g}),x=lo(b),E=io();let D=c;const R=Me(h,E&&E.onChange);let F=d;return E&&(typeof D>"u"&&(D=po(E.value,r.value)),typeof F>"u"&&(F=E.name)),o(uo,I({type:"radio",icon:f.cloneElement(m,{fontSize:(s=Ft.props.fontSize)!=null?s:g}),checkedIcon:f.cloneElement(a,{fontSize:(i=Ot.props.fontSize)!=null?i:g}),ownerState:b,classes:x,name:F,checked:D,onChange:R,ref:n,className:Qt(x.root,y)},T))}),$t=ho;function ae({value:t,decimalScale:e=2,prefix:n,className:s="",suffix:i}){return o(Be,{type:"text",valueIsNumericString:!0,value:t,allowLeadingZeros:!0,thousandSeparator:",",className:`number-display ${s}`,displayType:"text",decimalScale:e,prefix:n,suffix:i})}const C=()=>{const{t}=We("proposalPage");return{castVote:t("castVote"),timeLeftToVote:t("timeLeftToVote"),resultsVerified:t("resultsVerified"),verifyingResults:t("verifyingResults"),failedToVerifyResults:t("failedToVerifyResults"),address:t("address"),vote:t("vote"),votingPower:t("votingPower"),date:t("date"),voteStartsIn:t("voteStartsIn"),results:t("results"),recentVotes:t("recentVotes"),information:t("information"),startDate:t("startDate"),endDate:t("endDate"),snapshot:t("snapshot"),contract:t("contract"),votingStrategy:t("votingStrategy"),votes:t("votes"),showMore:t("showMore"),verifyInfo:t("verifyInfo"),downloadCsv:t("downloadCsv"),showLess:t("showLess"),yourVotingPower:t("yourVotingPower"),choice:t("choice"),notEnoughVotingPower:e=>t("notEnoughVotingPower",{value:e}),confirm:t("confirm"),noVotes:t("noVotes"),you:t("you"),httpsv2Endpoint:t("httpsv2Endpoint"),httpsv2ApiKey:t("httpsv2ApiKey"),httpv4Endpoint:t("httpv4Endpoint"),tonAccessEnpoint:t("tonAccessEnpoint"),customEndpoint:t("customEndpoint"),verify:t("verify"),rpcSelectTitle:t("rpcSelectTitle"),verifyResults:t("verifyResults")}},Ht=t=>t?ot.unix(t).valueOf():0;function fo(){const{proposalAddress:t}=S(),{data:e}=A(t),{proposalStatus:n}=wt(t),s=C(),i=e==null?void 0:e.metadata,r=f.useMemo(()=>n?n===M.NOT_STARTED?s.voteStartsIn:s.timeLeftToVote:"",[n]);return i?o(q,{title:r,children:n===M.NOT_STARTED?o(Nt,{date:Ht(i==null?void 0:i.proposalStartTime)}):n===M.ACTIVE?o(Nt,{date:Ht(i==null?void 0:i.proposalEndTime)}):null}):o(Y,{})}const gt=(t,e="MMM DD, YYYY HH:mm")=>`${ot.unix(t).utc().format(e)} UTC`,mo=()=>{const{proposalAddress:t}=S(),{isLoading:e,data:n}=A(t),s=C(),i=n==null?void 0:n.metadata,r=je(t),c=ze(t),a=c.jetton,p=c.nft,m=G(t);return e?o(Y,{}):o(yo,{title:s.information,children:i&&u(k,{gap:12,children:[o(H,{label:s.startDate,children:o(w,{children:gt(Number(i.proposalStartTime))})}),o(H,{label:s.endDate,children:o(w,{children:gt(Number(i.proposalEndTime))})}),o(H,{label:s.snapshot,children:o(w,{children:gt(Number(i.proposalSnapshotTime))})}),o(H,{label:s.contract,children:o(K,{address:t})}),o(H,{label:s.votingStrategy,children:m?o(Qn,{href:_e,target:"_blank",children:o(tt,{text:r})}):o(tt,{text:r})}),a&&o(H,{label:"Jetton Address",children:o(K,{address:a})}),p&&o(H,{label:"NFT collection",children:o(K,{address:p})})]})})},H=({label:t,children:e})=>u(go,{justifyContent:"space-between",gap:50,children:[o(w,{className:"row-label",children:t}),o("div",{className:"row-children",children:e})]}),go=l(v)({width:"100%",".row-label":{fontSize:14,fontWeight:700,whiteSpace:"nowrap"},".row-children":{"*":{fontSize:14,fontWeight:400}}}),yo=l(q)({width:"100%"}),ce=Ue(Ke(t=>({endpoints:void 0,setEndpoints:e=>{t({endpoints:e})}}),{name:"ton_vote_endpoints_verify_store"})),Mt=t=>{const e=n=>L.isNull(n)||L.isNaN(n)?0:L.isString(n)?Number(n):n;if(t)return L.forEach(t,(n,s)=>{t[s]=e(n)}),t},bo=()=>{const{proposalAddress:t}=S(),{data:e}=A(t),{setEndpoints:n,endpoints:s}=ce(),i=C(),r=Ye(),c=qe();return Ge(async a=>{n(a);const m=(async()=>{const d=await Dt.getClientV2(s==null?void 0:s.clientV2Endpoint,s==null?void 0:s.apiKey),h=await Dt.getClientV4(s==null?void 0:s.clientV4Endpoint),y=r.getValues(t).maxLtAfterVote||(e==null?void 0:e.maxLt)||"",T=await Ze.getProposal({clientV2:d,clientV4:h,proposalAddress:t,metadata:e==null?void 0:e.metadata,maxLt:y}),b=Mt(e==null?void 0:e.proposalResult),x=Mt(T==null?void 0:T.proposalResult);Qe({currentResults:b,compareToResults:x});const E=L.isEqual(b,x);if(!E)throw new Error("Not equal");return E})();return c({promise:m,success:i.resultsVerified,loading:i.verifyingResults,error:i.failedToVerifyResults}),L.isEmpty(e==null?void 0:e.proposalResult)?!0:m},{onError:a=>console.log(a.message)})},le=(t,e)=>{const n=st();return f.useMemo(()=>L.find(t,s=>s.address===n),[e,n])},vo=t=>{let e=[],n=[];return t?(e=["address","vote","date"],n=["address","vote"]):(e=["address","vote","votingPower","date"],n=["address","vote","votingPower"]),{titles:e,keys:n}},So=()=>{const t=C(),{proposalAddress:e}=S(),{data:n,dataUpdatedAt:s}=A(e),i=G(e);return f.useMemo(()=>{const r=vo(i),c=L.map(n==null?void 0:n.votes,a=>[...r.keys.map(m=>a[m]),ot.unix(a.timestamp).format("DD/MM/YY HH:mm:ss")]);return c.unshift(r.titles.map(a=>t[a])),c},[s])};function wo(t){const e=parseFloat(t);return!isNaN(e)&&isFinite(e)}function Bt(t){return typeof t=="string"&&t[t.length-1]==="%"&&wo(t.substring(0,t.length-1))}function yt(t,e){e===0&&(t!=null&&t.style)&&(t.style.display="none")}function Co(t,e){e===0&&(t!=null&&t.style)&&(t.style.display="")}const xo={animating:"rah-animating",animatingUp:"rah-animating--up",animatingDown:"rah-animating--down",animatingToHeightZero:"rah-animating--to-height-zero",animatingToHeightAuto:"rah-animating--to-height-auto",animatingToHeightSpecific:"rah-animating--to-height-specific",static:"rah-static",staticHeightZero:"rah-static--height-zero",staticHeightAuto:"rah-static--height-auto",staticHeightSpecific:"rah-static--height-specific"};function Wt(t,e){return[t.static,e===0&&t.staticHeightZero,e>0&&t.staticHeightSpecific,e==="auto"&&t.staticHeightAuto].filter(n=>n).join(" ")}const Ao=["animateOpacity","animationStateClasses","applyInlineTransitions","children","className","contentClassName","delay","duration","easing","height","onHeightAnimationEnd","onHeightAnimationStart","style"],de=t=>{const{animateOpacity:e=!1,animationStateClasses:n={},applyInlineTransitions:s=!0,children:i,className:r="",contentClassName:c,delay:a=0,duration:p=500,easing:m="ease",height:d,onHeightAnimationEnd:h,onHeightAnimationStart:g,style:y}=t,T=Object.assign({},t);Ao.forEach(J=>{delete T[J]});const b=f.useRef(d),x=f.useRef(null),E=f.useRef(),D=f.useRef(),R=f.useRef(Object.assign(Object.assign({},xo),n)),F=typeof window<"u",Z=f.useRef(F&&window.matchMedia?window.matchMedia("(prefers-reduced-motion)").matches:!1),z=Z.current?0:a,W=Z.current?0:p;let $=d,O="visible";typeof $=="number"?($=d<0?0:d,O="hidden"):Bt($)&&($=d==="0%"?0:d,O="hidden");const[ct,lt]=f.useState($),[ke,dt]=f.useState(O),[Re,Q]=f.useState(!1),[Ve,ut]=f.useState(Wt(R.current,d));f.useEffect(()=>{yt(x.current,ct)},[]),f.useEffect(()=>{if(d!==b.current&&x.current){Co(x.current,b.current),x.current.style.overflow="hidden";const J=x.current.offsetHeight;x.current.style.overflow="";const Rt=W+z;let N,V,pt="hidden",Vt;const ht=b.current==="auto";typeof d=="number"?(N=d<0?0:d,V=N):Bt(d)?(N=d==="0%"?0:d,V=N):(N=J,V="auto",pt=void 0),ht&&(V=N,N=J);const Pe=[R.current.animating,(b.current==="auto"||d<b.current)&&R.current.animatingUp,(d==="auto"||d>b.current)&&R.current.animatingDown,V===0&&R.current.animatingToHeightZero,V==="auto"&&R.current.animatingToHeightAuto,V>0&&R.current.animatingToHeightSpecific].filter(Ne=>Ne).join(" "),Lt=Wt(R.current,V);lt(N),dt("hidden"),Q(!ht),ut(Pe),clearTimeout(D.current),clearTimeout(E.current),ht?(Vt=!0,D.current=setTimeout(()=>{lt(V),dt(pt),Q(Vt),g==null||g(V)},50),E.current=setTimeout(()=>{Q(!1),ut(Lt),yt(x.current,V),h==null||h(V)},Rt)):(g==null||g(N),D.current=setTimeout(()=>{lt(V),dt(pt),Q(!1),ut(Lt),d!=="auto"&&yt(x.current,N),h==null||h(N)},Rt))}return b.current=d,()=>{clearTimeout(D.current),clearTimeout(E.current)}},[d]);const j=Object.assign(Object.assign({},y),{height:ct,overflow:ke||(y==null?void 0:y.overflow)});Re&&s&&(j.transition=`height ${W}ms ${m} ${z}ms`,y!=null&&y.transition&&(j.transition=`${y.transition}, ${j.transition}`),j.WebkitTransition=j.transition);const _={};e&&(_.transition=`opacity ${W}ms ${m} ${z}ms`,_.WebkitTransition=_.transition,ct===0&&(_.opacity=0));const Le=typeof T["aria-hidden"]<"u"?T["aria-hidden"]:d===0;return et.createElement("div",Object.assign({},T,{"aria-hidden":Le,className:`${Ve} ${r}`,style:j}),et.createElement("div",{className:c,style:_,ref:x},i))},To=()=>{const t=on(),e=C();return Fn().shape({clientV2Endpoint:mt().required(t.isRequired(e.httpsv2Endpoint)),apiKey:mt(),clientV4Endpoint:mt().required(t.isRequired(e.httpv4Endpoint))})},Eo=()=>{const t=C();return[{title:"",inputs:[{label:t.httpsv2Endpoint,type:"text",name:"clientV2Endpoint"},{label:t.httpsv2ApiKey,type:"text",name:"apiKey"},{label:t.httpv4Endpoint,type:"text",name:"clientV4Endpoint"}]}]};function ko({open:t,onClose:e,onSubmit:n}){const{endpoints:s}=ce(),[i,r]=f.useState(!1),c=To(),a=C(),p=Eo(),m=Je({initialValues:{apiKey:(s==null?void 0:s.apiKey)||Xe,clientV2Endpoint:(s==null?void 0:s.clientV2Endpoint)||tn,clientV4Endpoint:(s==null?void 0:s.clientV4Endpoint)||en},validationSchema:c,validateOnChange:!1,validateOnBlur:!0,onSubmit:async h=>{n({clientV2Endpoint:h.clientV2Endpoint,clientV4Endpoint:h.clientV4Endpoint,apiKey:h.apiKey}),e()}}),d=()=>{i?m.submitForm():(n({}),e())};return f.useEffect(()=>{r(!!(s!=null&&s.clientV2Endpoint)&&!!s.clientV4Endpoint)},[s==null?void 0:s.clientV2Endpoint,s==null?void 0:s.clientV4Endpoint,t]),o(Ro,{open:t,onClose:e,title:a.rpcSelectTitle,children:u(k,{gap:0,children:[u(k,{gap:5,children:[u(jt,{children:[o($t,{checked:!i,onChange:()=>r(!1)}),o(Ct,{children:a.tonAccessEnpoint})]}),u(jt,{children:[o($t,{checked:i,onChange:()=>r(!0)}),o(w,{children:a.customEndpoint})]})]}),o(de,{style:{width:"100%"},height:i?"auto":0,duration:200,children:o(nn,{form:p,formik:m})}),o(Vo,{onClick:d,children:a.verify})]})})}const jt=l(v)({a:{textDecoration:"unset",fontWeight:500,fontSize:17},justifyContent:"flex-start",p:{fontWeight:500,fontSize:17}}),Ro=l(te)({maxWidth:600,padding:0,".formik-form":{border:"unset!important",boxShadow:"unset",".title-container-children":{padding:20}}}),Vo=l(B)({width:"100%",maxWidth:200,marginTop:30,marginBottom:10}),zt=5,Lo=()=>{const{proposalAddress:t}=S(),{isLoading:e}=A(t),[n,s]=f.useState(!1),i=C(),r=sn(t),c=rn(t);return e?o(Y,{}):u(Ho,{title:i.results,children:[u(k,{gap:15,children:[c.map((a,p)=>p>=zt&&!n?null:o(Do,{name:a.choice,percent:a.percent,amount:a.amount,votes:a.votesCount},a.choice)),L.size(c)>zt&&o(Po,{toggle:s,value:n})]}),!r&&o(Mo,{})]})},Po=({toggle:t,value:e})=>{const n=C();return o(No,{onClick:()=>t(!e),children:e?n.showLess:n.showMore})},No=l(B)({padding:"6px 10px",height:"unset",marginLeft:"auto","*":{fontSize:12}}),Do=({name:t,percent:e=0,amount:n="",votes:s})=>{const i=C();return u($o,{children:[u(v,{justifyContent:"space-between",width:"100%",children:[u(v,{style:{width:"fit-content"},children:[o("div",{children:o(Io,{text:t})}),o(Oo,{label:`${xt(s,2)} ${i.votes}`})]}),u(Fo,{justifyContent:"flex-end",children:[n&&o(w,{fontSize:13,style:{whiteSpace:"nowrap"},children:n}),u(w,{className:"percent",children:[e,"%"]})]})]}),o(an,{progress:e})]})},Io=l(tt)({textTransform:"capitalize"}),Oo=l(ee)({fontSize:11,height:25,".MuiChip-label":{paddingLeft:10,paddingRight:10}}),Fo=l(v)({flex:1}),$o=l(k)({gap:5,fontWeight:600,p:{fontWeight:"inherit"},".percent":{fontSize:14}}),Ho=l(q)({width:"100%"});function Mo(){const{mutate:t,isLoading:e,error:n,isSuccess:s,reset:i}=bo(),r=C(),{proposalAddress:c}=S();f.useEffect(()=>{(s||n)&&setTimeout(()=>{i()},5e3)},[s,i,n]);const[a,p]=f.useState(!1),m=()=>{it.isMockProposal(c)?ne("This is a mock proposal. You can not verify it."):p(!0)};return u(Bo,{children:[o(Wo,{children:r.verifyInfo}),o(ko,{onSubmit:t,open:a,onClose:()=>p(!1)}),s?o(bt,{children:u(v,{children:[o(w,{children:"Verified"}),o(cn,{className:"icon"})]})}):n?o(bt,{children:u(v,{children:[o(w,{children:"Not Verified"}),o(ln,{className:"icon"})]})}):o(bt,{onClick:m,isLoading:e,children:o(w,{children:r.verifyResults})})]})}const Bo=l(k)(({theme:t})=>({marginTop:30,justifyContent:"center",width:"100%",gap:15})),Wo=l(Ct)({fontWeight:500,a:{textDecoration:"unset"}}),bt=l(B)({height:40,minWidth:180,"*":{fontSize:15},".icon":{width:18,height:18,position:"relative",top:-1},".loader":{maxWidth:20,maxHeight:20}});function jo({open:t,onClose:e,vote:n,onSubmit:s}){var h,g,y;const i=C(),{proposalAddress:r}=S(),{data:c}=A(r),{data:a,isLoading:p,refetch:m}=un(c,r);f.useEffect(()=>{t&&m()},[t]);const d=a?!!(a&&Number(a)===0):!0;return o(_o,{title:i.castVote,open:t,onClose:e,children:u(Yo,{gap:30,children:[u(k,{children:[o(Ko,{label:i.choice,value:n}),((h=c==null?void 0:c.metadata)==null?void 0:h.mcSnapshotBlock)&&o(St,{label:i.snapshot,value:o(ae,{value:(g=c==null?void 0:c.metadata)==null?void 0:g.mcSnapshotBlock})}),o(St,{isLoading:p,label:i.yourVotingPower,value:a})]}),d&&o(pn,{message:i.notEnoughVotingPower(((y=c==null?void 0:c.metadata)==null?void 0:y.mcSnapshotBlock.toLocaleString())||"")}),u(zo,{children:[o(B,{variant:"transparent",onClick:e,children:"Cancel"}),o(B,{disabled:d||p,onClick:()=>{s(),e()},children:i.confirm})]})]})})}const zo=l(v)({button:{width:"50%"}}),_o=l(te)({maxWidth:400,padding:0}),St=({label:t,value:e,isLoading:n,className:s=""})=>u(Uo,{className:s,justifyContent:"space-between",children:[o(w,{className:"label",children:t}),n?o(dn,{style:{width:20,height:20}}):o(w,{className:"value",children:e})]}),Uo=l(v)({".label":{fontWeight:700},".value":{fontWeight:600}}),Ko=l(St)({".value":{textTransform:"capitalize"}}),Yo=l(k)({});function qo(){var T;const[t,e]=f.useState(),{mutate:n,isLoading:s}=hn(),[i,r]=f.useState(!1),c=C(),{proposalAddress:a}=S(),{data:p,dataUpdatedAt:m}=A(a),d=(T=p==null?void 0:p.metadata)==null?void 0:T.votingSystem.choices,h=le(p==null?void 0:p.votes,m),g=h==null?void 0:h.vote;f.useEffect(()=>{t||e(h==null?void 0:h.vote)},[h==null?void 0:h.vote]);const y=()=>{it.isMockProposal(a)?ne("You can't vote on mock proposals"):r(!0)};return u(Xo,{title:c.castVote,children:[o(k,{children:d==null?void 0:d.map(b=>u(Jo,{selected:b===t,onClick:()=>e(b),children:[o(fn,{in:b===t,children:o(v,{className:"icon",children:o(mn,{style:{width:20,height:20}})})}),o(w,{children:b})]},b))}),o(rt,{text:g===t?`You already voted ${t}`:"",children:o(Go,{isLoading:s,disabled:!t||s||g===t,onSubmit:y})}),o(jo,{open:i,vote:t,onClose:()=>r(!1),onSubmit:()=>{t&&n(t)}})]})}const Go=({onSubmit:t,isLoading:e,disabled:n})=>st()?o(Zo,{onClick:t,isLoading:e,disabled:n,children:"Vote"}):o(Qo,{}),Zo=l(B)({marginTop:20,width:"100%"}),Qo=l($n)({marginTop:20,width:"100%"}),Jo=l(v)(({theme:t,selected:e})=>({transition:"0.2s all",width:"100%",borderRadius:30,height:40,cursor:"pointer",position:"relative",".icon":{position:"absolute",left:20,top:"50%",transform:"translate(0, -50%)",width:"fit-content"},border:e?`1.5px solid ${t.palette.primary.main}`:"1.5px solid rgba(114, 138, 150, 0.24)",color:t.palette.mode==="light"?t.palette.primary.main:"white",p:{color:"inherit",fontWeight:600,fontSize:16}})),Xo=l(q)({}),ts=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent),ue=t=>Array.isArray(t)&&t.every(e=>typeof e=="object"&&!(e instanceof Array)),es=t=>Array.isArray(t)&&t.every(e=>Array.isArray(e)),ns=t=>Array.from(t.map(e=>Object.keys(e)).reduce((e,n)=>new Set([...e,...n]),[])),os=(t,e)=>{e=e||ns(t);let n=e,s=e;ue(e)&&(n=e.map(r=>r.label),s=e.map(r=>r.key));const i=t.map(r=>s.map(c=>ss(c,r)));return[n,...i]},ss=(t,e)=>{const n=t.replace(/\[([^\]]+)]/g,".$1").split(".").reduce(function(s,i,r,c){const a=s[i];if(a==null)c.splice(1);else return a},e);return n===void 0?t in e?e[t]:"":n},is=t=>typeof t>"u"||t===null?"":t,pe=(t,e=",",n='"')=>t.filter(s=>s).map(s=>s.map(i=>is(i)).map(i=>`${n}${i}${n}`).join(e)).join(`
`),rs=(t,e,n,s)=>pe(e?[e,...t]:t,n,s),as=(t,e,n,s)=>pe(os(t,e),n,s),cs=(t,e,n,s)=>e?`${e.join(n)}
${t}`:t.replace(/"/g,'""'),he=(t,e,n,s)=>{if(ue(t))return as(t,e,n,s);if(es(t))return rs(t,e,n,s);if(typeof t=="string")return cs(t,e,n);throw new TypeError('Data should be a "String", "Array of arrays" OR "Array of objects" ')},fe=(t,e,n,s,i)=>{const r=he(t,n,s,i),c=ts()?"application/csv":"text/csv",a=new Blob([e?"\uFEFF":"",r],{type:c}),p=`data:${c};charset=utf-8,${e?"\uFEFF":""}${r}`,m=window.URL||window.webkitURL;return typeof m.createObjectURL>"u"?p:m.createObjectURL(a)},me={data:P.oneOfType([P.string,P.array,P.func]).isRequired,headers:P.array,target:P.string,separator:P.string,filename:P.string,uFEFF:P.bool,onClick:P.func,asyncOnClick:P.bool,enclosingCharacter:P.string},ge={separator:",",filename:"generatedBy_react-csv.csv",uFEFF:!0,asyncOnClick:!1,enclosingCharacter:'"'},ls={target:"_blank"};class _t extends et.Component{constructor(e){super(e),this.state={}}buildURI(){return fe(...arguments)}componentDidMount(){const{data:e,headers:n,separator:s,enclosingCharacter:i,uFEFF:r,target:c,specs:a,replace:p}=this.props;this.state.page=window.open(this.buildURI(e,r,n,s,i),c,a,p)}getWindow(){return this.state.page}render(){return null}}U(_t,"defaultProps",Object.assign(ge,ls)),U(_t,"propTypes",me);var X;let ds=(X=class extends et.Component{constructor(e){super(e),this.buildURI=this.buildURI.bind(this)}buildURI(){return fe(...arguments)}handleLegacy(e,n=!1){if(window.navigator.msSaveOrOpenBlob){e.preventDefault();const{data:s,headers:i,separator:r,filename:c,enclosingCharacter:a,uFEFF:p}=this.props,m=n&&typeof s=="function"?s():s;let d=new Blob([p?"\uFEFF":"",he(m,i,r,a)]);return window.navigator.msSaveBlob(d,c),!1}}handleAsyncClick(e){const n=s=>{if(s===!1){e.preventDefault();return}this.handleLegacy(e,!0)};this.props.onClick(e,n)}handleSyncClick(e){if(this.props.onClick(e)===!1){e.preventDefault();return}this.handleLegacy(e)}handleClick(){return e=>{if(typeof this.props.onClick=="function")return this.props.asyncOnClick?this.handleAsyncClick(e):this.handleSyncClick(e);this.handleLegacy(e)}}render(){const{data:e,headers:n,separator:s,filename:i,uFEFF:r,children:c,onClick:a,asyncOnClick:p,enclosingCharacter:m,...d}=this.props,g=typeof window>"u"?"":this.buildURI(e,r,n,s,m);return o("a",{download:i,...d,ref:y=>this.link=y,target:"_self",href:g,onClick:this.handleClick(),children:c})}},U(X,"defaultProps",ge),U(X,"propTypes",me),X);const us=ds,ps=()=>{var m;const{proposalAddress:t}=S(),{data:e}=A(t),n=((m=e==null?void 0:e.proposalResult)==null?void 0:m.totalWeight)||"0",s=L.size(e==null?void 0:e.votes),i=G(t),r=bn(t),c=f.useMemo(()=>xt(Number(vn.fromNano(n))),[n]),a=Tt(t);return u(fs,{children:[o(Es,{label:u(Sn,{children:[o(ae,{value:s})," votes"]})}),u(v,{style:{width:"unset"},gap:10,children:[!(r||i)&&u(w,{className:"total",style:{fontWeight:600},children:[c," ",a]}),o(bs,{})]})]})},hs=()=>{const{proposalAddress:t}=S(),{data:e,dataUpdatedAt:n}=A(t),s=le(e==null?void 0:e.votes,n),i=Tt(t),r=G(t);return o(ye,{hideVotingPower:!!r,symbol:i,data:s})},fs=l(v)({flex:1,justifyContent:"space-between",".total":{fontSize:14},"@media (max-width: 600px)":{".total":{fontSize:13}}});function ms(){var d;const t=st(),[e,n]=f.useState(ft),s=C(),{proposalAddress:i}=S(),{data:r,isLoading:c}=A(i),a=G(i),p=Tt(i),m=()=>{n(h=>h+ft)};return c?o(Y,{}):u(Ts,{title:s.recentVotes,headerComponent:o(ps,{}),children:[o(Hn,{isLoading:c,isEmpty:!c&&!L.size(r==null?void 0:r.votes),emptyComponent:o(ys,{}),children:u(As,{gap:0,children:[o(hs,{}),(d=r==null?void 0:r.votes)==null?void 0:d.map((h,g)=>g>=e||h.address===t?null:o(ye,{hideVotingPower:!!a,symbol:p,data:h},h.address))]})}),o(gs,{totalItems:L.size(r==null?void 0:r.votes),amountToShow:e,showMore:m,limit:ft})]})}const gs=l(gn)({marginTop:20,width:"90%",marginLeft:"auto",marginRight:"auto",marginBottom:20}),ys=()=>{const t=C();return o(Cs,{children:o(w,{children:t.noVotes})})},bs=()=>{var i;const{proposalAddress:t}=S(),{data:e}=A(t),n=So(),s=C();return o(us,{data:n,filename:at((i=e==null?void 0:e.metadata)==null?void 0:i.title),children:o(rt,{text:s.downloadCsv,placement:"top",children:o(vs,{style:{width:18,height:18}})})})},vs=l(yn)(({theme:t})=>({"*":{stroke:t.palette.text.primary}})),ye=({data:t,symbol:e,hideVotingPower:n})=>{const s=st(),i=C();if(!t)return null;const{address:r,votingPower:c,vote:a,hash:p,timestamp:m}=t,d=s===r;return o(Ss,{text:`${ot.unix(m).utc().fromNow()}`,placement:"top",children:u(xs,{justifyContent:"flex-start",children:[o(ws,{address:r,displayText:d?i.you:""}),o(w,{className:"vote",style:{textAlign:n?"right":"center"},children:L.isArray(a)?a.join(", "):a}),!n&&u(w,{className:"voting-power",children:[xt(Number(c))," ",e]})]})})},Ss=l(rt)({width:"100%"}),ws=l(K)({justifyContent:"flex-start",width:160}),Cs=l(At)({padding:"20px",p:{textAlign:"center",fontSize:17,fontWeight:600}}),xs=l(v)({borderBottom:"0.5px solid rgba(114, 138, 150, 0.16)",padding:"15px 25px",gap:10,".vote":{flex:1,textAlign:"center"},".voting-power":{width:160,textAlign:"right",gap:5,".number-display":{flex:1}},"@media (max-width: 850px)":{alignItems:"flex-start",flexWrap:"wrap",".address":{maxWidth:"60%"},".date":{},".vote":{flex:"unset",marginLeft:"auto"},".voting-power":{width:"100%",textAlign:"left",justifyContent:"flex-start",".number-display ":{flex:"unset",maxWidth:"70%"}}}}),As=l(k)({}),Ts=l(q)({".title-container-children":{padding:0}}),Es=l(ee)({height:28,"*":{fontWeight:600,fontSize:13}}),vt=200,ks=()=>{const{proposalAddress:t}=S(),{isLoading:e}=A(t),n=kn();return e?o(Y,{loaderAmount:4}):o(Ms,{children:n?o(Vs,{}):o(Rs,{})})};function Rs(){return u(k,{alignItems:"flex-start",gap:20,children:[o(be,{}),u(Ae,{justifyContent:"flex-start",children:[o(Se,{}),o(Ce,{}),o(xe,{}),o(we,{url:window.location.href})]}),o(ve,{})]})}function Vs(){return u(k,{alignItems:"flex-start",gap:20,children:[o(be,{}),u(Ae,{justifyContent:"flex-start",children:[u(v,{justifyContent:"flex-start",children:[o(Se,{}),o(Ce,{})]}),u(v,{children:[o(xe,{}),o(we,{url:window.location.href})]})]}),o(ve,{})]})}const be=()=>{var i;const{proposalAddress:t}=S(),e=A(t).data,n=it.isMockProposal(t)?" (Mock)":"",s=at((i=e==null?void 0:e.metadata)==null?void 0:i.title);return u(v,{children:[o(Is,{title:`${s}${n}`}),e&&o(Ls,{proposal:e})]})},Ls=l(wn)({position:"absolute",top:7,right:7}),Ps=({onClick:t,showMore:e})=>{const n=C();return o(Hs,{open:e?1:0,children:o($s,{onClick:()=>t(!e),variant:"transparent",children:o(w,{children:e?n.showLess:n.showMore})})})},ve=()=>{var d,h;const[t,e]=f.useState(0),n=f.useRef(),{proposalAddress:s}=S(),{data:i}=A(s),[r,c]=f.useState(!1);f.useLayoutEffect(()=>{n.current&&e(n.current.offsetHeight)},[(d=i==null?void 0:i.metadata)==null?void 0:d.description]);const a=at((h=i==null?void 0:i.metadata)==null?void 0:h.description),p=t>vt,m=t>vt?vt:t;return u(Ns,{children:[o(Ds,{ref:n,children:o(Ut,{open:0,children:a})}),o(de,{height:r?"auto":m,duration:0,children:o(Ut,{open:r?1:0,children:a})}),p&&o(Ps,{showMore:r,onClick:c})]})},Ns=l(At)({position:"relative"}),Ds=l("span")({position:"absolute",visibility:"hidden",pointerEvents:"none",height:"auto"}),Ut=l(Ct)(({open:t})=>({img:{display:t?"block":"none"},ul:{paddingLeft:20},ol:{paddingLeft:20}})),Is=l(Cn)({marginBottom:0,marginTop:0}),Se=()=>{const{proposalAddress:t}=S(),{proposalStatusText:e}=wt(t);return o(Mn,{status:e})},we=l(xn)({marginLeft:"auto"}),Ce=()=>{var n;const{daoAddress:t}=S(),e=(n=Et(t).data)==null?void 0:n.daoMetadata;return u(v,{style:{width:"auto"},children:[o(Fs,{src:e==null?void 0:e.metadataArgs.avatar}),o(Os,{to:se.daoPage.root(t),className:"dao-name",children:o(tt,{text:at(e==null?void 0:e.metadataArgs.name)})})]})},xe=()=>{var n;const{daoAddress:t}=S(),e=(n=Et(t).data)==null?void 0:n.daoRoles;return e!=null&&e.proposalOwner?o(K,{displayText:`by ${Rn(e==null?void 0:e.proposalOwner,5)}`,address:(e==null?void 0:e.proposalOwner)||"",padding:5}):null},Os=l(An)({display:"flex"}),Fs=l(Tn)({minWidth:30,minHeight:30,width:30,height:30,borderRadius:"50%"}),Ae=l(v)({".dao-name":{p:{fontSize:15,fontWeight:600}},".by":{fontSize:15,fontWeight:600},".address-display-btn":{p:{fontSize:15,fontWeight:600}},"*":{textDecoration:"unset"},[`@media (max-width: ${oe}px)`]:{flexDirection:"column",alignItems:"flex-start"}}),$s=l(B)(({theme:t})=>({marginLeft:"auto",marginRight:"auto",width:"100%"})),Hs=l(At)(({open:t,theme:e})=>{const n=e.palette.mode==="light"?"0px -22px 50px 16px #FFFFFF":"0px -22px 50px 16px #222830";return{width:"100%",position:"relative",boxShadow:t===1?"unset":n,background:e.palette.mode==="light"?"white":"#222830",paddingTop:20}}),Ms=l(En)({width:"100%",padding:30,paddingTop:40,position:"relative",[`@media (max-width: ${oe}px)`]:{padding:20}}),kt=15,Te=()=>{const{proposalAddress:t}=S(),e=A(t).isLoading,{proposalStatus:n}=wt(t);return{proposalDescription:o(ks,{}),votes:!n||n===M.NOT_STARTED?null:o(ms,{}),vote:!n||n!==M.ACTIVE||e?null:o(qo,{}),deadline:!n||n===M.CLOSED?null:o(fo,{}),metadata:o(mo,{}),results:!n||n===M.NOT_STARTED?null:o(Lo,{})}},Bs=()=>{const{proposalDescription:t,votes:e,vote:n,deadline:s,metadata:i,results:r}=Te();return u(Ee,{children:[u(_s,{children:[t,n,e]}),u(Us,{children:[s,i,r]})]})},Ws=()=>{const{proposalDescription:t,votes:e,vote:n,deadline:s,metadata:i,results:r}=Te();return u(Ee,{children:[s,t,n,r,i,e]})};function ti(){const t=Vn("(max-width:800px)"),[e,n]=f.useState(!1),{daoAddress:s,proposalAddress:i}=S(),r=A(i).error,c=Ln(i);f.useEffect(()=>{r&&n(!0)},[r]);const a=c||e,p=it.isMockProposal(i);return o(Bn,{back:se.daoPage.root(s),headerComponent:!p&&o(js,{}),children:a?o(Pn,{text:"Proposal not found"}):t?o(Ws,{}):o(Bs,{})})}const js=()=>{const{proposalPage:t}=Nn(),{daoAddress:e,proposalAddress:n}=S(),{data:s}=Et(e),i=Dn(),{isLoading:r}=A(n),{isOwner:c,isProposalPublisher:a}=In(s==null?void 0:s.daoRoles);return r||!i||!c&&!a?null:o(rt,{text:"Edit",children:o(zs,{onClick:()=>t.edit(e,n),children:o(On,{style:{width:20,height:20,color:"white"}})})})},zs=l(v)({padding:0,width:35,height:35,borderRadius:"50%",background:"#0088CC",cursor:"pointer"}),Ee=l(v)({gap:kt,alignItems:"flex-start","@media (max-width: 850px)":{flexDirection:"column"}}),_s=l(k)({width:"calc(100% - 370px - 10px)",gap:kt}),Us=l(k)({width:370,gap:kt});export{ti as ProposalDisplay,ti as default};
