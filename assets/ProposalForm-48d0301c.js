import{ad as z,I as q,ae as k,af as M,ag as d,P as Y,s as g,T as R,C as L,ah as U,b as s,j as I,f as $,a9 as A,ai as _,_ as u,aj as F,ak as b,al as x,am as G,an as Q,ao as Z,ap as K,aq as X,ar as H,F as D,as as ee,u as te,a as re,at as oe,au as j,av as N,aw as ne,ax as se,ay as ie,az as ae,aA as le,m as de,t as pe,aB as ue,o as ce,aC as me}from"./index-b73c198c.js";import{c as he,a as E,b as O,C as ge}from"./index.esm-416d522b.js";const J=()=>{const{t:e}=z("createProposal");return q.useMemo(()=>({votingParameters:e("votingParameters"),formTitle:e("createProposal"),subTitle:e("subTitle"),title:e("title"),description:e("description"),votingPowerStrategy:e("votingPowerStrategy"),jettonAddress:e("jettonAddress"),votingChoices:e("votingChoices"),votingPeroid:e("votingPeroid"),votingPeriodInfo:e("votingPeriodInfo"),startTime:e("startTime"),endTime:e("endTime"),snaphotTime:e("snaphotTime"),proposalDuration:e("proposalDuration"),nftAddress:e("nftAddress"),tooltips:{title:e("tooltips.title"),description:e("tooltips.description"),votingPowerStrategy:e("tooltips.votingPowerStrategy"),jettonAddress:e("tooltips.jettonAddress"),votingChoices:e("tooltips.votingChoices"),startTime:e("tooltips.startTime"),endTime:e("tooltips.endTime"),snapshotTime:e("tooltips.snapshotTime")},errors:{isRequired:o=>e("errors.isRequired",{value:o}),titleLength:e("errors.titleLength",{value:k}),aboutLength:e("errors.aboutLength",{value:M}),invalidJettonAddress:e("errors.invalidJettonAddress"),invalidNFTAddress:e("errors.invalidNFTAddress"),startTime1:e("errors.startTime1"),startTime2:e("errors.startTime2"),endTime1:e("errors.endTime1"),endTime2:e("errors.endTime2"),endTime3:e("errors.endTime3"),snapshotTime1:e("errors.snapshotTime1")}}),[e])},Te=(e,o,t)=>{const r=J(),{proposalStartTime:i,proposalEndTime:m}=e;return q.useMemo(()=>{const P=d(e.proposalStartTime),v=d(e.proposalEndTime),T=d.duration(d(v).diff(d(P))),f=T.days(),S=T.hours(),n=f<0||S<0,a={title:"",subTitle:r.subTitle,inputs:[{label:r.title,type:"text",name:"title_en",required:!0,limit:k,tooltip:r.tooltips.title},{label:r.description,type:"textarea",name:"description_en",rows:9,tooltip:r.tooltips.description,limit:M,isMarkdown:!0,required:!0}]},c={title:r.votingParameters,inputs:[{label:r.votingPowerStrategy,type:"custom",name:"votingPowerStrategies",tooltip:r.tooltips.votingPowerStrategy,required:!0},{label:r.votingChoices,type:"list",name:"votingChoices",required:!0,disabled:!0,tooltip:r.tooltips.votingChoices}]},p=n?"":`${f} days ${S?`and ${S} hours`:""} `,h={title:r.votingPeroid,inputsInRow:2,subTitle:r.votingPeriodInfo,inputs:[{label:r.startTime,type:"date",name:"proposalStartTime",required:!0,tooltip:r.tooltips.startTime},{label:r.endTime,type:"date",name:"proposalEndTime",required:!0,tooltip:r.tooltips.endTime},{label:r.snaphotTime,type:"date",name:"proposalSnapshotTime",required:!0,tooltip:r.tooltips.snapshotTime},{style:{width:"100%"},label:"",type:"display-text",name:"",text:p?`${r.proposalDuration} ${p}`:""},{label:"Hide",type:"checkbox",name:"hide",tooltip:"Hide proposal from public view"}]};return o?t===Y.NOT_STARTED?[a,c,h]:[a]:[a,c,h]},[i,m,r])};function fe({open:e,onClose:o,onSubmit:t,variant:r}){const i=ve(r);return s(be,{open:e,onClose:o,title:"Proposal visibility",children:I($,{gap:40,children:[s(Se,{children:i}),I(ye,{children:[s(A,{variant:"transparent",onClick:o,children:"Cancel"}),s(A,{onClick:t,children:"Confirm"})]})]})})}const ve=e=>e==="hide"||e==="changed-to-hide"?"This proposal will be hidden from the list of proposals. You can change it later in the settings section.":"This proposal will be visible in the list of proposals.",Se=g(R)({fontSize:17,fontWeight:600}),ye=g(L)({gap:20,button:{width:"50%"}}),be=g(U)({maxWidth:500}),Pe=["Yes","No","Abstain"],we=(e,o,t)=>{const{proposalEndTime:r,proposalSnapshotTime:i,proposalStartTime:m}=xe();return{proposalStartTime:t?_(e.proposalStartTime).valueOf():m,proposalEndTime:t?_(e.proposalEndTime).valueOf():r,proposalSnapshotTime:t?_(e.proposalSnapshotTime).valueOf():i,votingChoices:e.votingChoices||Pe,description_en:e.description_en,description_ru:e.description_ru,votingSystemType:e.votingSystemType||0,title_en:e.title_en,votingPowerStrategies:Ce(e.votingPowerStrategies,o),hide:e.hide||!1}},Ce=(e,o)=>{const t=o==null?void 0:o.daoMetadata.metadataArgs;if(e&&u.size(e))return e;const r=t!=null&&t.jetton&&!F(t==null?void 0:t.jetton)?t.jetton:"",i=t!=null&&t.nft&&!F(t==null?void 0:t.nft)?t==null?void 0:t.nft:"";return r?[{type:b.VotingPowerStrategyType.JettonBalance,arguments:[{name:"jetton-address",value:r}]}]:i?[{type:b.VotingPowerStrategyType.NftCcollection,arguments:[{name:"nft-address",value:i}]}]:[{type:b.VotingPowerStrategyType.TonBalance,arguments:[]}]},xe=()=>{const e=d().valueOf();let o=d(e).add("1","day").set("h",15).set("s",0).set("minute",0).valueOf();return d(e).utc().hour()<15&&(o=d(o).subtract("1","day").valueOf()),{proposalStartTime:o,proposalEndTime:d(o).add("7","days").valueOf(),proposalSnapshotTime:d(o).subtract("1","day").set("h",0).set("minute",0).valueOf()}},qe=(e,o)=>{const t=o==null?void 0:o.daoMetadata.metadataArgs,r=t!=null&&t.nft&&!F(t==null?void 0:t.nft)?t==null?void 0:t.nft:"",i=t!=null&&t.jetton&&!F(t==null?void 0:t.jetton)?t==null?void 0:t.jetton:"";switch(e.name){case"nft-address":return{...e,default:r};case"jetton-address":return{...e,default:i};default:return e}},$e=e=>({proposalStartTime:Math.floor(x(e.proposalStartTime).valueOf()/1e3),proposalEndTime:Math.floor(x(e.proposalEndTime).valueOf()/1e3),proposalSnapshotTime:Math.floor(x(e.proposalSnapshotTime).valueOf()/1e3),votingSystem:{votingSystemType:e.votingSystemType,choices:e.votingChoices},title:JSON.stringify({en:e.title_en}),description:JSON.stringify({en:e.description_en}),votingPowerStrategies:e.votingPowerStrategies,quorum:"",hide:e.hide}),Ie=(e,o,t)=>{var i;const r=u.find(e,m=>m.type==o);return r?(i=u.find(r.arguments,m=>m.name===t))==null?void 0:i.value:""},je=()=>{const{daoAddress:e}=te(),{data:o,dataUpdatedAt:t}=re(e);return q.useMemo(()=>u.mapValues(oe,r=>({...r,args:u.map(r.args,i=>qe(i,o))})),[t])};function Ee(e){const{selectedStrategies:o=[],label:t,formik:r,required:i,tooltip:m,name:P}=e,v=je(),T=u.map(o,n=>n.type.toString()),f=n=>{const a=[n.target.value[n.target.value.length-1]],c=u.map(r.values.votingPowerStrategies,l=>l.type);let p=u.filter(r.values.votingPowerStrategies,l=>a.includes(l.type));const h=u.filter(u.difference(a,c),l=>a.includes(l));u.forEach(u.compact(h),l=>{p.push({type:l,arguments:[]})}),r.setFieldValue(P,p)},S=(n,a,c)=>{const p=r.values.votingPowerStrategies,h=u.map(p,l=>{if(l.type!=n)return l;const y=u.find(l==null?void 0:l.arguments,w=>w.name===a);if(y){y.value=c;const w=l.arguments.findIndex(C=>C.name);return{type:l.type,arguments:l.arguments.splice(w,1,y)}}return{type:l.type,arguments:[...l.arguments,{name:a,value:c}]}});r.setFieldValue(P,h)};return I(Be,{children:[s(Z,{title:t,required:i,tooltip:m}),I($,{alignItems:"flex-start",gap:20,children:[s(K,{fullWidth:!0,sx:{maxWidth:600},children:s(X,{value:T,onChange:f,renderValue:n=>s(H,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(a=>{const c=v[a].name;return s(R,{children:c},a)})}),MenuProps:{anchorOrigin:{vertical:"bottom",horizontal:"center"},PaperProps:{style:{width:"fit-content",borderRadius:10,border:"1px solid #e0e0e0",boxShadow:"rgb(114 138 150 / 8%) 0px 2px 16px"}}},children:u.map(v,(n,a)=>{const c=T.includes(a);return s(Fe,{value:a,bg:c?1:0,children:s(L,{justifyContent:"space-between",gap:30,children:s(R,{children:n.name})})},a)})})}),s(D,{children:u.map(v,(n,a)=>{var c;return T.includes(a)?(c=n.args)==null?void 0:c.map(p=>{const h=Ie(o,a,p.name),l=r.errors;return s("div",{style:{maxWidth:"600px",width:"100%"},children:s(ee,{formik:r,args:p,value:h,error:l[p.name],clearError:()=>r.setFieldError(p.name,void 0),onChange:y=>{S(a,p.name,y)}})},p.name)}):null})})]})]})}const Be=g(G)({".MuiSelect-select":{padding:"13.4px 15px"}}),Fe=g(Q)(({bg:e})=>({paddingTop:10,paddingBottom:10,marginBottom:10,borderRadius:10,marginLeft:10,marginRight:10,background:e?"rgba(0, 136, 204, 0.08)!important":"transparent!important",".MuiTouchRipple-root":{display:"none"},":last-child":{marginBottom:0},"&:hover":{background:!e&&"rgba(0, 136, 204, 0.04)!important"}})),B=e=>{try{return e.votingPowerStrategies[0].arguments[0].value}catch{return""}},_e=()=>{const e=J();return he().shape({title_en:E().required(e.errors.isRequired(e.title)).test("",e.errors.titleLength,o=>u.size(o)<=k),description_en:E().required(e.errors.isRequired(e.description)).test("",e.errors.aboutLength,o=>u.size(o)<=M),"jetton-address":E().test("",e.errors.invalidJettonAddress,(o,t)=>{const r=t.parent;return j(r.votingPowerStrategies)==b.VotingPowerStrategyType.JettonBalance?N(B(r)):!0}).test("",e.errors.isRequired(e.jettonAddress),(o,t)=>{const r=t.parent;return j(r.votingPowerStrategies)==b.VotingPowerStrategyType.JettonBalance?!!B(r):!0}),"nft-address":E().test("",e.errors.invalidNFTAddress,(o,t)=>{const r=t.parent;return j(r.votingPowerStrategies)==b.VotingPowerStrategyType.NftCcollection?N(B(r)):!0}).test("",e.errors.isRequired(e.nftAddress),(o,t)=>{const r=t.parent;return j(r.votingPowerStrategies)==b.VotingPowerStrategyType.NftCcollection?!!B(r):!0}),proposalStartTime:O().required(e.errors.isRequired(e.startTime)).test("",e.errors.startTime1,(o=0)=>d().isBefore(x(o))).test("",e.errors.startTime2,(o=0)=>d(o).isBefore(d().add("10","days"))),proposalEndTime:O().required(e.errors.isRequired(e.endTime)).test("",e.errors.endTime1,(o=0,t)=>d(o).isAfter(d(t.parent.proposalStartTime))).test("",e.errors.endTime2,(o=0,t)=>d(o).diff(d(t.parent.proposalStartTime),"days")>0).test("",e.errors.endTime3,(o=0,t)=>d(o).diff(d(t.parent.proposalStartTime),"days")<=10),proposalSnapshotTime:O().test("",e.errors.snapshotTime1,(o=0)=>x().isAfter(d(o))).required(e.errors.isRequired(e.snaphotTime))})};function He({onSubmit:e,isLoading:o,initialFormData:t,persistForm:r,dao:i,editMode:m=!1,submitText:P,status:v}){const T=Te(t,m,v),f=ne(i.daoAddress).data,S=_e(),n=se({initialValues:we(t,i,m),validationSchema:S,onSubmit:e,validateOnChange:!1,validateOnBlur:!0}),a=Le(n),[c,p]=q.useState(),h=ie(()=>{r==null||r(n.values)});q.useEffect(()=>{h()},[n.values]);const l=async()=>{const C=n.values.hide,V=t.hide,W=await n.validateForm(n.values);if(!u.isEmpty(W)){ue(n);return}if(ce.isMockDao(i.daoAddress)){me("This is a mock DAO. You cannot create/edit proposals.");return}!m&&C?p("hide"):m&&C&&!V?p("changed-to-hide"):m&&!C&&V?p("changed-to-show"):n.submitForm()},y=()=>{p(void 0),n.submitForm()},w=m?u.isEqual(n.values,n.initialValues):!1;return s(ae,{in:!0,children:I(Oe,{alignItems:"flex-start",children:[s(le,{formik:n,form:T,customInputHandler:a,children:s(Re,{submitText:P,isLoading:o||(f==null?void 0:f.fwdMsgFee)===void 0,onSubmit:l,disabled:w})}),s(fe,{variant:c,onClose:()=>p(void 0),open:!!c,onSubmit:y})]})})}const Oe=g(L)({flex:1,".date-input":{".MuiFormControl-root":{width:"100%"}}});function Re({onSubmit:e,isLoading:o,submitText:t,disabled:r}){const i=de();return s(pe,{text:r?"You need to change at least 1 input to proceed.":"",children:s(Ae,{children:i?s(Me,{disabled:r,isLoading:o,onClick:e,children:t}):s(ke,{})})})}const Ae=g(H)({width:"100%",maxWidth:400,marginLeft:"auto",marginRight:"auto",marginTop:80}),ke=g(ge)({width:"100%"}),Me=g(A)({width:"100%"}),Le=e=>o=>{const t=e.values.votingPowerStrategies;return s(Ee,{required:o.required,tooltip:o.tooltip,selectedStrategies:t||[],label:o.label,formik:e,name:o.name})};export{He as P,$e as p};
